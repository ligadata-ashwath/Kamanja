<!DOCTYPE html>
<!--
  ~ Copyright 2015 ligaDATA
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html lang="en">

<head>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <title>Powered by ligaDATA</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="_css/bootstrap-flat/css/bootstrap-flat.min.css" rel="stylesheet" />
    <link href="_css/bootstrap-flat/css/bootstrap-flat-extras.min.css" rel="stylesheet" />

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.0/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet" />

    <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.2/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet" />

    <link href="_js/bootstrap-slider/css/bootstrap-slider.min.css" rel="stylesheet">

    <link href="_css/styles.css" rel="stylesheet">

    <link rel="shortcut icon" href="_images/favicon.ico">

</head>

<body>

    <div class="navbar navbar-default navbar-static-top">

        <div class="container">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!--                <a class="navbar-brand" href="#">Brand</a>-->
                <img alt="barclays" src="./_images/logo-mobil.png" />
            </div>

            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">

                    <li>
                        <a class="home">Home</a>
                    </li>
                    <li class="active">
                        <a class="processing">Start Processing</a>
                    </li>

                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>

    </div>

    <div class="cont-body">

        <div class="container text-center">

            <div class="row">

                <div class="col-md-4 col-sm-12">

                    <h1 class="project-name">
                    Project VEGA
                </h1>

                </div>

                <div class="col-md-4 col-sm-12">

                    <div class="start-container">

                        <input type="checkbox" name="my-checkbox" data-on-text="start" data-off-text="stop">

                    </div>

                    <span class="counter counter-analog counter-style" style="color: #00008b" data-direction="up" data-format="23:59:59">00:00:00</span>
                    <span class="counter-label"> Elapsed Time </span>
                </div>

                <div class="col-md-4 col-sm-12">

                    <div class="list-group sms-container">
                        <a class="list-group-item" id="modal-130070" href="#modal-container-sms" data-toggle="modal"><i
                            class="fa fa-envelope-o fa-3x"></i>&nbsp; <span class="sms-counter">0</span></a>
                    </div>

                </div>

            </div>

            <div class="row">

                <div class="col-md-12 col-xs-12">
                    <div id="upper-container" style="height: 300px"></div>
                </div>

            </div>

            <div class="row">

                <div class="col-md-3 col-xs-12">

                    <span class="count-trans counter-style">0</span>
                    <span class="counter-label"> TRANSACTIONS Processed </span>

                </div>

                <div class="col-md-1 col-xs-12">

                    <span class="tps subcounter-label"> (0 tps) </span>

                </div>

                <div class="col-md-3 col-xs-12">
                    <span class="count-queue counter-style">0</span>
                    <span class="counter-label"> Alerts Queued </span>
                </div>

                <div class="col-md-1 col-xs-12">
                    <span class="aps subcounter-label"> (0 aps) </span>
                </div>

                <div class="col-md-4 col-xs-12">

                    <span class="count-latency counter-style">0</span>
                    <span class="counter-label">  average alerts latency in seconds </span>

                </div>

            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <div class="carousel-container">

                        <div id="myCarousel" class="carousel">

                            <!-- Carousel items -->
                            <div>
                                <div class="item">
                                    <div class="row">

                                        <div class="col-sm-1 col-sm-offset-2">
                                            <div class="slider-content slider-content-1" data-id="eb1">
                                                <h2>0</h2>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <div class="slider-content slider-content-2" data-id="eb2">
                                                <h2>0</h2>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <div class="slider-content slider-content-3" data-id="nod1">
                                                <h2>0</h2>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <div class="slider-content slider-content-4" data-id="od1">
                                                <h2>0</h2>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <div class="slider-content slider-content-5" data-id="od2">
                                                <h2>0</h2>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <div class="slider-content slider-content-6" data-id="od3">
                                                <h2>0</h2>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <div class="slider-content slider-content-7" data-id="lb">
                                                <h2>0</h2>
                                            </div>
                                        </div>

                                    </div>
                                    <!--/row-->
                                </div>

                            </div>

                            <!--/carousel-inner-->
                            <a class="left carousel-control hidden-xs" href="#myCarousel" data-slide="prev"><i
                                class="fa fa-chevron-left fa-inverse fa-2x"></i></a>
                            <a class="right carousel-control hidden-xs" href="#myCarousel" data-slide="next"><i
                                class="fa fa-chevron-right fa-inverse fa-2x"></i></a>
                        </div>
                        <!--/myCarousel-->
                    </div>
                    <!--/well-->
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-xs-12">
                    <div id="chart-container"></div>
                </div>
            </div>

            <br>

            <div class="row">

                <div class="col-md-12 col-xs-12">

                    <div class="well well-lg">
                        <ul id="log-area">
                        </ul>

                    </div>

                </div>

            </div>

        </div>

    </div>

    <div class="modal fade" id="modal-container-sms" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">
                    SMS List
                </h4>
                </div>
                <div class="modal-body text-left">

                    <ul id="sms-list" class="sms-list">

                        <script id="sms-template" type="text/x-jQuery-tmpl">
                            <li> <h5> ${AlertText} </h5> </li>
                        </script>

                    </ul>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info btn-striped" data-dismiss="modal">Close</button>
                    <!--                                        <button type="button" class="btn btn-info btn-striped">Save changes</button>-->
                </div>

            </div>

        </div>

    </div>
    <!-- /.container -->

    <!-- script references -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!--highcharts-->
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <script src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script>
    <script src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script>
    <script src="_js/jquery.createCanvas.js"></script>

    <script src="_js/bootstrap-slider/bootstrap-slider.min.js"></script>

    <script src="_js/jquery-counter/src/jquery.counter.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.0.2/js/bootstrap-switch.min.js"></script>

    <script src="_js/jquery.tmpl.min.js" type="text/javascript"></script>

    <script src="_js/scripts.js"></script>
    <script src="_js/events.js"></script>

    <script src="_js/webServicesReferences.js"></script>

    <script>
        var first = true;

        var eventsInfoResult = [];
        var alertsResult = [];
        var messageScrollAlertsResult = [];

        var smsCounter = 0;
        var chartData = [];

        var engineStarted = false;

        $(document).ready(function() {

            $("[name='my-checkbox']").bootstrapSwitch();

            //init

            $('#myCarousel').carousel({
                interval: 0
            });
            $('#myCarousel').on('slid.bs.carousel', function() {});

            //service call

            $('input[name="my-checkbox"]').on('switchChange.bootstrapSwitch', function(event, state) {

                if ($('input[name="my-checkbox"]').bootstrapSwitch('state')) {

                    engineStarted = true;

                    $('.counter').counter();

                    $('.counter').counter('reset');
                    $('.counter').counter('play');

                    $.ajax({
                        url: start,
                        data: {
                            start: 1
                        },
                        success: function(result) {

                            // startProcessing();
                        },
                        error: function(error) {

                            console.log("engine started");
                        }
                    });

                    startProcessing();

                } else {

                    $('.counter').counter('stop');

                    $.ajax({
                        url: start,
                        data: {
                            start: 0
                        },
                        success: function(result) {

                        },
                        error: function(error) {

                            console.log("engine started");
                        }
                    });

                    engineStarted = false;
                }
            });

        });

        function startProcessing() {

            $.ajax({
                url: getEventsInfo,
                data: {
                    reset: first
                },
                success: function(result) {

                    eventsInfoResult = $.parseJSON($(result).text()).EventsInfo;
                    alertsResult = $.parseJSON($(result).text()).Alerts;
                    messageScrollAlertsResult = $.parseJSON($(result).text()).MessageScrollAlerts;
                },
                error: function(error) {

                    console.log($.parseJSON($(result).text()));
                }
            });

            if (eventsInfoResult != null && eventsInfoResult.AlertsPerType != null) {

                chartData = [{
                    y: eventsInfoResult.AlertsPerType['EB1'],
                    color: '#FFD700'
                }, {
                    y: parseInt(eventsInfoResult.AlertsPerType['EB2']),
                    color: '#66CD00'
                }, {
                    y: parseInt(eventsInfoResult.AlertsPerType['NOD']),
                    color: '#FF8C00'
                }, {
                    y: parseInt(eventsInfoResult.AlertsPerType['OD1']),
                    color: '#FF0000'
                }, {
                    y: parseInt(eventsInfoResult.AlertsPerType['OD2']),
                    color: '#9400D3'
                }, {
                    y: parseInt(eventsInfoResult.AlertsPerType['OD3']),
                    color: '#8B8878'
                }, {
                    y: parseInt(eventsInfoResult.AlertsPerType['LB']),
                    color: '#3A5FCD'
                }];

                var chart = $('#upper-container').highcharts();
                chart.series[0].setData(chartData);

                $('.slider-content-1 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['EB1'], 2));
                $('.slider-content-2 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['EB2'], 2));
                $('.slider-content-3 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['NOD'], 2));
                $('.slider-content-4 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['OD1'], 2));
                $('.slider-content-5 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['OD2'], 2));
                $('.slider-content-6 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['OD3'], 2));
                $('.slider-content-7 h2').text(numberAbbreviations(eventsInfoResult.AlertsPerType['LB'], 2));

                $('.count-trans').text(numberAbbreviations(eventsInfoResult.TransactionsProcessed, 2));
                $('.count-queue').text(numberAbbreviations(eventsInfoResult.TotalAlertsQueued, 2));
                $('.count-latency').text(eventsInfoResult.EndToEndLatency);

                $('.tps').text('(' + numberAbbreviations(eventsInfoResult.TransactionsPerSecond, 0) + ' TPS)');
                $('.aps').text('(' + numberAbbreviations(eventsInfoResult.AlertsPerSecond, 0) + ' APS)');
            }

            if (messageScrollAlertsResult.length != 0 && messageScrollAlertsResult != null) {

                $("ul#log-area > li:gt(9)").remove();

                var change = function(txt) {

                    $("#log-area").prepend('<li>' + txt + '</li>');
                };

                $.each(messageScrollAlertsResult, function () {

                    change(this);
                });

            }

            if (alertsResult.length != 0 && alertsResult != null) {

                sendSms(alertsResult);
            }

            if (first) {

                first = false;
            }

            if (engineStarted) {

                setTimeout(arguments.callee, 1000);
            }
        }

        function sendSms(alertsResult) {

            if (localStorage['mobileNo'] != undefined) {

                var nos = localStorage['mobileNo'].split("");

                $.each(alertsResult, function() {

                    var alertName = "";
                    switch (this.AlertType.toLowerCase()) {
                        case 'eb1':

                            alertName = 'Emergency Borrowing 1';
                            break;
                        case 'eb2':

                            alertName = 'Emergency Borrowing 2';
                            break;
                        case 'nod':

                            alertName = 'Near Overdraft';
                            break;
                        case 'od1':

                            alertName = 'Overdraft 1';
                            break;
                        case 'od2':

                            alertName = 'Overdraft 2';
                            break;
                        case 'od3':

                            alertName = 'Overdraft 3';
                            break;
                        case 'lb':

                            alertName = 'Low Balance';
                            break;
                        default:
                            break;
                    }

                    var smsText = alertName.toUpperCase() + " - Balance: GBP (" + this.Balance + ") - Time: (" + this.TimeStamp + ") - Alert Latency: (" + this.AlertLatency + ") - ligaDATA Demo";

                    smsCounter++;
                    $('.sms-counter').text(smsCounter);

                    localStorage['SMS' + smsCounter] = alertsResult;

                    $.ajax({
                        url: SendSms,
                        data: {
                            no: localStorage['mobileNo'],
                            text: smsText,
                            us: nos[0] == 1 ? 1 : 0
                        },
                        success: function(result) {

                            console.log(result);
                        }
                    });

                    $("#sms-template").tmpl({
                        AlertText: smsText
                    }).appendTo('#sms-list');
                });
            }
        }

    </script>

</body>

</html>